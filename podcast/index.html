<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Lewis Wake | Podcast Hub</title>
    <meta
      name="description"
      content="Exclusive podcast episodes and DJ mixes from Lewis Wake."
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="../css/screen.css"
      media="screen"
      type="text/css"
    />

    <style>
      .brand-apple {
        background: linear-gradient(135deg, #b150e2 0%, #8928ba 100%);
      }
      .brand-pocketcasts {
        background: linear-gradient(135deg, #f43e37 0%, #c41f18 100%);
      }
      .brand-castro {
        background: linear-gradient(135deg, #00b265 0%, #00824a 100%);
      }
      .brand-overcast {
        background: linear-gradient(135deg, #fc7e0f 0%, #d46200 100%);
      }
      .brand-rss {
        background: linear-gradient(135deg, #ff424d 0%, #cc2b35 100%);
      }

      .icon-box svg {
        width: 32px;
        height: 32px;
        fill: #ffffff;
      }

      /* Square Header Image */
      .podcast-cover {
        width: 200px;
        height: 200px;
        border-radius: 20px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        object-fit: cover;
        flex-shrink: 0;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: opacity 0.3s ease;
      }

      /* Update to Tag styling to align the icon */
      .list-text span {
        display: inline-flex;
        align-items: center;
      }

      svg.external-icon {
        width: 14px;
        height: 14px;
        margin-left: 6px;
        fill: currentColor;
        vertical-align: middle;
      }

      .episode-card {
        margin-bottom: 24px;
      }

      .episode-header {
        display: flex;
        gap: 16px;
        align-items: flex-start;
        margin-bottom: 16px;
      }

      .episode-thumb {
        width: 90px;
        height: 90px;
        border-radius: 12px;
        object-fit: cover;
        flex-shrink: 0;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        background-color: rgba(255, 255, 255, 0.05);
      }

      .episode-title-group {
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .episode-title-group h4 {
        font-size: 1.25rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 6px;
        line-height: 1.3;
      }

      .episode-meta {
        font-size: 0.85rem;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .episode-desc {
        font-size: 0.95rem;
        color: var(--text-secondary);
        margin-bottom: 20px;
        line-height: 1.6;
      }

      audio {
        width: 100%;
        outline: none;
        border-radius: 50px;
      }
      audio::-webkit-media-controls-panel {
        background-color: rgba(255, 255, 255, 0.9);
      }

      /* Patreon Post Button */
      .btn-post {
        display: inline-flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        padding: 10px 18px;
        border-radius: 12px;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 600;
        margin-top: 16px;
        transition:
          background 0.2s,
          transform 0.2s;
        border: 1px solid rgba(255, 255, 255, 0.15);
      }

      .btn-post:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.02);
      }

      .loading {
        text-align: center;
        color: var(--text-secondary);
        padding: 2rem 0;
        font-weight: 500;
      }

      .error-text {
        color: #ff424d;
      }

      @media (max-width: 600px) {
        .podcast-cover {
          margin-bottom: 16px;
          width: 160px;
          height: 160px;
        }
      }

      @media (max-width: 500px) {
        .episode-thumb {
          width: 70px;
          height: 70px;
        }
        .episode-title-group h4 {
          font-size: 1.1rem;
        }
      }
    </style>
  </head>

  <body>
    <div class="aurora-bg"></div>

    <div class="main-wrapper">
      <header class="header-profile">
        <img
          class="podcast-cover"
          src="https://lewiswake.com/requests/assets/images/lewis-wake-dj-520x347.jpg"
          alt="Lewis Wake Podcast Artwork"
          id="podcast-image"
        />
        <div class="header-text">
          <h1 id="podcast-title">Podcast Hub</h1>
          <h2 id="podcast-desc">Loading feed...</h2>
        </div>
      </header>

      <h3>Add to podcast app</h3>
      <div class="grid-2">
        <a
          href="podcast://www.patreon.com/rss/lewiswakedj?auth=5CsHG3OIirvdg6qUlIzx9jyQVma5Pl4e&show=1513098"
          class="glass interactive list-item"
        >
          <div class="icon-box brand-apple">
            <svg viewBox="0 0 24 24">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-7.5c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"
              />
            </svg>
          </div>
          <div class="list-text">
            <h4>Apple Podcasts</h4>
            <span
              >Add
              <svg class="external-icon" viewBox="0 0 24 24">
                <path
                  d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"
                /></svg
            ></span>
          </div>
        </a>

        <a
          href="pktc://subscribe/www.patreon.com/rss/lewiswakedj?auth=5CsHG3OIirvdg6qUlIzx9jyQVma5Pl4e&show=1513098"
          class="glass interactive list-item"
        >
          <div class="icon-box brand-pocketcasts">
            <svg viewBox="0 0 24 24">
              <path
                d="M12 2a10 10 0 00-10 10c0 5.52 4.48 10 10 10s10-4.48 10-10A10 10 0 0012 2zm0 16.5c-3.59 0-6.5-2.91-6.5-6.5S8.41 5.5 12 5.5s6.5 2.91 6.5 6.5-2.91 6.5-6.5 6.5zm-2-9.5l5 3-5 3v-6z"
              />
            </svg>
          </div>
          <div class="list-text">
            <h4>Pocket Casts</h4>
            <span
              >Add
              <svg class="external-icon" viewBox="0 0 24 24">
                <path
                  d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"
                /></svg
            ></span>
          </div>
        </a>

        <a
          href="castro://subscribe/www.patreon.com/rss/lewiswakedj?auth=5CsHG3OIirvdg6qUlIzx9jyQVma5Pl4e&show=1513098"
          class="glass interactive list-item"
        >
          <div class="icon-box brand-castro">
            <svg viewBox="0 0 24 24">
              <path
                d="M12 2.02c-5.51 0-9.98 4.47-9.98 9.98s4.47 9.98 9.98 9.98 9.98-4.47 9.98-9.98-4.47-9.98-9.98-9.98zm0 15.96c-3.3 0-5.98-2.68-5.98-5.98s2.68-5.98 5.98-5.98 5.98 2.68 5.98 5.98-2.68 5.98-5.98 5.98zm-1.5-8.5v5l4-2.5-4-2.5z"
              />
            </svg>
          </div>
          <div class="list-text">
            <h4>Castro</h4>
            <span
              >Add
              <svg class="external-icon" viewBox="0 0 24 24">
                <path
                  d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"
                /></svg
            ></span>
          </div>
        </a>

        <a
          href="overcast://x-callback-url/add?url=https://www.patreon.com/rss/lewiswakedj?auth=5CsHG3OIirvdg6qUlIzx9jyQVma5Pl4e&show=1513098"
          class="glass interactive list-item"
        >
          <div class="icon-box brand-overcast">
            <svg viewBox="0 0 24 24">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z"
              />
            </svg>
          </div>
          <div class="list-text">
            <h4>Overcast</h4>
            <span
              >Add
              <svg class="external-icon" viewBox="0 0 24 24">
                <path
                  d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"
                /></svg
            ></span>
          </div>
        </a>

        <a
          href="#"
          onclick="copyRss(event, this)"
          class="glass interactive list-item"
        >
          <div class="icon-box brand-rss">
            <svg viewBox="0 0 24 24">
              <path
                d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93v-2.83z"
              />
            </svg>
          </div>
          <div class="list-text">
            <h4>RSS Feed</h4>
            <span id="rss-badge">Copy Link</span>
          </div>
        </a>
      </div>

      <h3>All Episodes</h3>
      <div id="episodes-container">
        <div class="glass">
          <div class="loading" id="loading-msg">
            Fetching episodes directly from Patreon...
          </div>
        </div>
      </div>

      <footer class="footer-links">
        <p>&copy; 2026 Lewis Wake</p>
        <a href="../index.html">Return to Main Site</a>
      </footer>
    </div>

    <script>
      const rssFeedUrl =
        "https://www.patreon.com/rss/lewiswakedj?auth=5CsHG3OIirvdg6qUlIzx9jyQVma5Pl4e&show=1513098";

      function copyRss(event, element) {
        event.preventDefault();
        const badge = element.querySelector("#rss-badge");

        navigator.clipboard
          .writeText(rssFeedUrl)
          .then(() => {
            const originalText = badge.innerHTML;
            badge.innerText = "Copied!";
            badge.style.backgroundColor = "#4CAF50";
            badge.style.color = "#fff";

            setTimeout(() => {
              badge.innerHTML = originalText;
              badge.style.backgroundColor = "";
              badge.style.color = "";
            }, 2000);
          })
          .catch((err) => {
            console.error("Failed to copy text: ", err);
            badge.innerText = "Error";
          });
      }

      const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(rssFeedUrl)}`;

      fetch(proxyUrl)
        .then((response) => {
          if (!response.ok)
            throw new Error(`Proxy responded with status: ${response.status}`);
          return response.text();
        })
        .then((str) => {
          const parser = new DOMParser();
          const xmlDoc = parser.parseFromString(str, "text/xml");

          const parseError = xmlDoc.querySelector("parsererror");
          if (parseError)
            throw new Error("The feed data couldn't be parsed properly.");

          const channel = xmlDoc.querySelector("channel");

          const channelTitle =
            channel.querySelector("title")?.textContent || "Podcast Hub";
          const channelDesc =
            channel.querySelector("description")?.textContent ||
            "Exclusive episodes and mixes.";
          document.getElementById("podcast-title").innerText = channelTitle;
          document.getElementById("podcast-desc").innerText = channelDesc;

          let showImage =
            "https://lewiswake.com/requests/assets/images/lewis-wake-dj-520x347.jpg";
          try {
            const itunesChannelImage =
              channel.getElementsByTagName("itunes:image")[0];
            if (itunesChannelImage && itunesChannelImage.getAttribute("href")) {
              showImage = itunesChannelImage.getAttribute("href");
            } else {
              const stdImageNode = channel.querySelector("image > url");
              if (stdImageNode) showImage = stdImageNode.textContent;
            }
          } catch (e) {
            console.warn("Could not parse main channel image.");
          }

          document.getElementById("podcast-image").src = showImage;

          const container = document.getElementById("episodes-container");
          container.innerHTML = "";

          const items = xmlDoc.querySelectorAll("item");

          if (items.length === 0) {
            container.innerHTML =
              '<div class="glass"><p class="loading">No episodes found in the feed.</p></div>';
            return;
          }

          items.forEach((item) => {
            const titleNode = item.querySelector("title");
            const title = titleNode
              ? titleNode.textContent
              : "Untitled Episode";

            const descNode = item.querySelector("description");
            let description = descNode ? descNode.textContent : "";

            // Allow breaks but strip heavier HTML for clean rendering
            description = description
              .replace(/<p>/g, "")
              .replace(/<\/p>/g, "<br><br>")
              .trim();

            // Extract the Patreon Post Link
            const linkNode = item.querySelector("link");
            const postLink = linkNode ? linkNode.textContent : "";

            const pubDateNode = item.querySelector("pubDate");
            let formattedDate = "";
            if (pubDateNode) {
              formattedDate = new Date(
                pubDateNode.textContent,
              ).toLocaleDateString("en-US", {
                year: "numeric",
                month: "long",
                day: "numeric",
              });
            }

            // Extract Episode Number
            let episodeNumText = "";
            try {
              const itunesEpisode = item.getElementsByTagName("itunes:episode");
              if (itunesEpisode.length > 0 && itunesEpisode[0].textContent) {
                episodeNumText = `Episode ${itunesEpisode[0].textContent} &bull; `;
              }
            } catch (e) {
              console.warn("Could not parse episode number.");
            }

            const enclosureNode = item.querySelector("enclosure");
            const audioUrl = enclosureNode
              ? enclosureNode.getAttribute("url")
              : "";
            const audioType = enclosureNode
              ? enclosureNode.getAttribute("type")
              : "audio/mpeg";

            let episodeImage = showImage;
            try {
              const itunesImageNS = item.getElementsByTagNameNS("*", "image");
              if (
                itunesImageNS.length > 0 &&
                itunesImageNS[0].getAttribute("href")
              ) {
                episodeImage = itunesImageNS[0].getAttribute("href");
              } else {
                const itunesImageRegular =
                  item.getElementsByTagName("itunes:image");
                if (
                  itunesImageRegular.length > 0 &&
                  itunesImageRegular[0].getAttribute("href")
                ) {
                  episodeImage = itunesImageRegular[0].getAttribute("href");
                }
              }
            } catch (e) {
              console.warn("Image parse skipped for an episode.");
            }

            // Only generate the card if there's an audio file
            if (audioUrl) {
              // Generate the Patreon Button HTML if a link exists
              let patreonButtonHtml = "";
              if (postLink) {
                patreonButtonHtml = `<a href="${postLink}" target="_blank" rel="noopener noreferrer" class="btn-post">View on Patreon <svg class="external-icon" viewBox="0 0 24 24"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg></a>`;
              }

              const article = document.createElement("article");
              article.className = "glass episode-card";

              article.innerHTML = `
                            <div class="episode-header">
                                <img src="${episodeImage}" class="episode-thumb" alt="Episode Artwork" loading="lazy">
                                <div class="episode-title-group">
                                    <h4>${title}</h4>
                                    <div class="episode-meta">${episodeNumText}Published on ${formattedDate}</div>
                                </div>
                            </div>
                            <div class="episode-desc">${description}</div>
                            <audio controls preload="none">
                                <source src="${audioUrl}" type="${audioType}">
                                Your browser does not support the audio element.
                            </audio>
                            ${patreonButtonHtml}
                        `;

              container.appendChild(article);
            }
          });
        })
        .catch((error) => {
          console.error("Feed Error:", error);
          document.getElementById("episodes-container").innerHTML =
            `<div class="glass"><p class="loading error-text"><strong>Could not load feed.</strong><br>Patreon may be temporarily blocking proxy access. Please try refreshing.<br><small>${error.message}</small></p></div>`;
        });
    </script>
  </body>
</html>
